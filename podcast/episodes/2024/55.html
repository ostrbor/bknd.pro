<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Backend Podcast: 55. PGO: inlining & branching</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-normalize@2.0.0/modern-normalize.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap"
          rel="stylesheet">
    <link href="../../css/css.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div id="other-platforms">
        <a href="https://feeds.acast.com/public/shows/64727c07e689970012fb1c23">RSS</a>
        <a href="https://t.me/bkndpro">Telegram</a>
        <a href="https://www.youtube.com/@ostrbor/videos">YouTube</a>
        <a href="https://podcasts.apple.com/us/podcast/backend-podcast/id1732130106">Apple</a>
        <a href="https://music.yandex.ru/album/28370806">Яндекс</a>
        <a href="https://open.spotify.com/show/6G9K0DrOH2wsEqDKbed01e?si=oQXKuI4tQKqgJj894-2p_A">Spotify</a>
        <a href="https://music.amazon.com/podcasts/d797927c-7c90-4d4b-a845-3b61dc25060c/backend-podcast">Amazon</a>
        <a href="mailto:OstretsovAA+podcast@gmail.com">Почта</a>
    </div>

    <hgroup>
        <h1>55. PGO: inlining & branching</h1>
        <h2>09.06.2024</h2>
    </hgroup>

    <p>
        <iframe src="https://embed.acast.com/64727c07e689970012fb1c23/66660ba1b46da30012f6530b?theme=light"
                frameBorder="0" width="100%" height="190px"></iframe>
        <a href="https://bknd.pro/podcast-files/055_backend_podcast.mp3">Скачать</a>
    </p>

    <p>
        <a href="../../index.html">К списку выпусков</a>
    </p>

    <h4>Оптимизация кода с PGO: Как это работает и зачем нужно</h4>

    <p>
        Программная оптимизация — важный аспект разработки, особенно когда речь идет о производительности. Одним из
        методов
        такой оптимизации является Profile Guided Optimization (PGO). Давайте разберемся, что это такое и как это
        работает.
    </p>

    <h4>Что такое PGO?</h4>

    <p>
        PGO — это процесс, при котором ваш сервер запускается в продакшн среде в специальном режиме, чтобы собирать
        статистику выполнения. Затем сервер компилируется заново с учетом этой статистики, что позволяет компилятору
        создавать более производительный исполняемый файл.
    </p>

    <p>
        Полученный исполняемый файл состоит из инструкций на машинном языке, называемом ассемблером. Суть PGO —
        оптимизировать эти инструкции. Сегодня я расскажу о двух подходах: инлайнинг и бранчинг.
    </p>

    <h4>Компилятор Go и его особенности</h4>

    <p>
        Компилятор Go известен своей скоростью компиляции. В отличие от других языков, где процесс компиляции может
        занимать
        длительное время, Go делает это очень быстро благодаря своей простоте. Создатели Go сделали приоритетом быструю
        компиляцию и небольшой размер бинарных файлов.
    </p>

    <h4>Инлайнинг</h4>

    <p>
        Когда в исходном коде есть функция, компилятор создает для неё подпрограмму (субрутину) на языке ассемблера.
        Вызов
        подпрограммы требует дополнительных инструкций, таких как создание переменных для параметров и переход в нужное
        место кода. Это создает некоторый оверхед.
    </p>

    <p>
        Инлайнинг — это процесс встраивания кода функции прямо в место её вызова, что уменьшает количество инструкций и
        ускоряет выполнение. Но почему бы тогда не инлайнить все функции? Дело в том, что это увеличивает размер
        бинарного
        файла, а небольшой размер был приоритетом для создателей Go. Поэтому инлайнят только самые часто используемые
        функции.
    </p>

    <h4>Бранчинг</h4>

    <p>
        Чтобы понять бранчинг, нужно знать о CPU пайплайнинге. Представьте, что у вас есть задача сварить борщ. Этот
        процесс
        состоит из разных стадий: приготовление овощей, нагрев воды, варка. Для ускорения можно выполнять некоторые
        стадии
        параллельно, например, сначала поставить воду на огонь, а потом чистить овощи.
    </p>

    <p>
        В CPU пайплайнинг работает по схожему принципу. Инструкции выполняются в несколько стадий: считывание,
        декодирование, выполнение и запись в память. Все эти стадии могут выполняться параллельно. Но если в коде есть
        ветвление (бранчинг), пайплайн может «застопориться», не зная, какую ветку выполнять дальше.
    </p>

    <p>
        Сбор статистики позволяет предсказывать, какая ветка будет выполняться чаще, и начинать её выполнение заранее.
        Если
        предсказание окажется неверным, процессор сбрасывает выполненные операции и начинает выполнять правильную ветку.
        Чем
        точнее предсказания, тем быстрее работает программа.
    </p>

    <h4>Заключение</h4>

    <p>
        PGO помогает оптимизировать код, делая программы быстрее и эффективнее. Инлайнинг уменьшает количество
        инструкций, а
        бранчинг позволяет эффективно использовать CPU пайплайнинг. Оба подхода помогают достичь более высокой
        производительности, что особенно важно для серверных приложений.
    </p>

    <div id="footer">
        By <a href="https://bknd.pro">bknd.pro</a>
    </div>
</div>
</body>
</html>